<!DOCTYPE html>
<html ng-app="myApp">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title><%= title %></title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- font awesome -->
    <link href="css/font-awesome.min.css" rel="stylesheet">

    <!-- angularJS CDN script 태그 추가  -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>


    <script>
      var app = angular.module('myApp', []);


      /*
       main state 정의 ('/' 라우팅)
      */
      // app.config(function($locationProvider, $routeProvider) {
      //     $routeProvider
      //       .when('/board', { // 상태 정의
      //         templateUrl: 'board.ejs', // 템플릿 경로
      //         controller: 'MainCtrl', // 컨트롤러 이름
      //     });
      // });

      app.controller("myCtrl",function($scope, $http, $location) {
        $scope.email = 'bae419@naver.com';
        $scope.password = '1111';
        // 로그인 버튼 핸들러
        $scope.goLogin = function () {
          $scope.msg = '';

          // 백엔드에 인증을 시도한다.
          $http.post('/users/login', {
            email: $scope.email,
            password: $scope.password
          }).success(function (data, status) {
            // 인증 성공시 메인페이지('/')로 이동
            location.href ="/board/board_main";
            //$scope.apply();
            console.log(data);
          }).error(function (data, status) {
            console.log(data, status);

            // 인증 실패시 재로그인을 안내한다.
            $scope.msg = '로그인 정보 오류: 로그인 정보를 다시 입력하세요.';
          });
        };

        //회원가입
        $scope.goJoin = function () {
          $scope.msg = '';
        }
      });
    </script>
  </head>
  <body ng-controller="myCtrl">
    <div class="container">
      <div class="row">
        <div class="page-header">
          <h2>심플한 로그인 폼</h2>
        </div>
        <div class="col-md-3">
          <div class="login-box well">
            <form accept-charset="UTF-8" role="form" method="post" ng-submit="goLogin()">
                <legend>로그인</legend>
                <div class="form-group">
                    <label for="username-email">이메일</label>
                    <input name="email"  id="email" placeholder="E-mail" type="text" class="form-control" ng-model="email"/>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input name="password" id="password"  placeholder="Password" type="password" class="form-control" ng-model="password"/>
                </div>
                <div class="form-group">
                  <p style="color:red"><%= loginError %></p>
                <div>
                <div class="form-group">
                    <input type="submit" class="btn btn-default btn-login-submit btn-block m-t-md" value="Login" />
                    <button class="btn btn-default btn-login-submit btn-block m-t-md" ng-click="goLogin()" >회원가입</button>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>


  </body>
  </html>
